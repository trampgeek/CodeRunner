{"version":3,"file":"ui_scratchpad.min.js","sources":["../src/ui_scratchpad.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more util.details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Implementation of the scratchpad_ui user interface plugin. For overall details\n * of the UI plugin architecture, see userinterfacewrapper.js.\n *\n * This plugin replaces the usual textarea answer element with a UI is designed to\n * allow the execution of code in the CodeRunner question in a manner similar to an IDE.\n * It contains two editor boxes, one on top of another, allowing users to enter and\n * edit code in both. It contains two embedded Ace UIs.\n *  By default, only the top editor is visible and the bottom editor (Scratchpad Area) is hidden,\n * clicking the Scratchpad button shows it. The Scratchpad area contains a second editor,\n * a Run button and a Prefix with Answer checkbox. Additionally, there is a help button that\n * provides information about how to use the Scratchpad.\n *  It's possible to run code 'in-browser' by clicking the Run Button,\n * without making a submission via the Check Button:\n *          If Prefix with Answer is not checked, only the code in the Scratchpad is run --\n *      allowing for a rough working spot to quickly check the result of code.\n *          Otherwise, when Prefix with Answer is checked, the code in the Scratchpad is\n *      appended to the code in the first editor before being run.\n *  The Run Button has some limitations when using its default configuration:\n *     Does not support programs that use STDIN (by default);\n *     Only supports textual STDOUT (by default).\n * Note: These features can be supported, see the README section on wrappers...\n *  The serialisation of this UI is a JSON object with the fields\n * with fields:\n *      answer_code: [\"\"] A list containing a string with answer code from the first editor;\n *      test_code: [\"\"] A list containing a string with containing answer code from the second editor;\n *      show_hide: [\"1\"] when scratchpad is visible, otherwise [\"\"];\n *      prefix_ans: [\"1\"] when Prefix with Answer is checked, otherwise [\"\"].\n *\n * UI Parameters:\n *    - scratchpad_name: display name of the scratchpad, used to hide/un-hide the scratchpad.\n *    - button_name: run button text.\n *    - prefix_name: prefix with answer check-box label text.\n *    - help_text: help text to show.\n *    - run_lang: language used to run code when the run button is clicked,\n *      this should be the language your wrapper is written in (if applicable).\n *    - wrapper_src: location of wrapper code to be used by the run button, if applicable:\n *      setting to globalextra will use text in global extra field,\n *    - prototypeextra will use the prototype extra field.\n *    - output_display_mode: control how program output is displayed on runs, there are three modes:\n *          - text: display program output as text, html escaped;\n *          - json: display program output, when it is json,\n *          - html: display program output as raw html.\n *      NOTE: see qtype_coderunner/outputdisplayarea.js for more info...\n *    - disable_scratchpad: disable the scratchpad, effectively reverting to the Ace UI\n *      from student perspective.\n *    - invert_prefix: inverts meaning of prefix_ans serialisation -- '1' means un-ticked, vice versa.\n *      This can be used to swap the default state.\n *\n * @module qtype_coderunner/ui_scratchpad\n * @copyright  Richard Lobb, 2022, The University of Canterbury\n * @copyright  James Napier, 2022, The University of Canterbury\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\nimport Templates from 'core/templates';\n\nimport {newUiWrapper} from 'qtype_coderunner/userinterfacewrapper';\nimport {OutputDisplayArea} from 'qtype_coderunner/outputdisplayarea';\n\n\n/**\n * Invert serialisation from '1' to '', vice versa.\n * @param {string} current serialisation.\n * @returns {string} inverted serialisation.\n */\nconst invertSerial = (current) => current[0] === '1' ? [''] : ['1'];\n\n/**\n * Insert the answer code and test code into the wrapper. This may\n * be defined by the user, in UI Params or globalextra. If prefixAns is\n * false: do not include answerCode in final wrapper.\n * @param {string} answerCode text from first editor.\n * @param {string} testCode text from second editor.\n * @param {string} prefixAns '1' for true, '' for false.\n * @param {string} template provided in UI Params or globalextra.\n * @param {string} open delimiter to look for, e.g. '[['\n * @param {string} close delimiter to look for, e.g. ']]'\n * @returns {string} filled template.\n */\nconst fillWrapper = (answerCode, testCode, prefixAns, template, open = '\\\\(', close = '\\\\)') => {\n    if (!template) {\n        template = `${open} ANSWER_CODE ${close}\\n` +\n                   `${open} SCRATCHPAD_CODE ${close}`;\n    }\n    if (!prefixAns) {\n        answerCode = '';\n    }\n    const escOpen = escapeRegExp(open);\n    const escClose = escapeRegExp(close);\n    const answerRegex = new RegExp(`${escOpen}\\\\s*ANSWER_CODE\\\\s*${escClose}`, 'g');\n    const scratchpadRegex = new RegExp(`${escOpen}\\\\s*SCRATCHPAD_CODE\\\\s*${escClose}`, 'g');\n    // Use arrow functions in replace operations to avoid special-case treatment of $.\n    template = template.replaceAll(answerRegex, () => answerCode);\n    template = template.replaceAll(scratchpadRegex, () => testCode);\n    return template;\n};\n\n/**\n * Escapes a string for use in regex.\n * @param {string} string to escape.\n * @returns {string} RegEx escaped string\n */\nconst escapeRegExp = (string) => string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\"); // $& means the whole matched string\n\n/**\n * Returns a new object contain default values. If a matching key exists in\n * prescribed, the corresponding value from prescribed will replace the default value.\n * Does not add keys/values to the result if that key is not in defaults.\n * @param {object} defaults object with values to be overwritten.\n * @param {object} prescribed settings, typically set by a user.\n * @returns {object} filled with default values, overwritten by their prescribed value (iff included).\n */\nconst overwriteValues = (defaults, prescribed) => {\n    let overwritten = {...defaults};\n    if (prescribed) {\n        for (const [key, value] of Object.entries(defaults)) {\n            overwritten[key] = prescribed[key] || value;\n        }\n    }\n    return overwritten;\n};\n\n/**\n * Is a collapsed element currently collapsed?\n * @param {Element} el which is collapsed using a bootstrap collapse.\n * @returns {boolean} true if el is collapsed.\n */\nconst isCollapsed = (el) => {\n    if (!(el.classList.contains('collapse') || el.classList.contains('collapsing'))) {\n        throw Error('Element does not have collapse class');\n    }\n    return !el.classList.contains('show');\n};\n\n\n/**\n * Constructor for the ScratchpadUi object.\n * @param {string} textAreaId The ID of the html textarea.\n * @param {int} width The width in pixels of the textarea.\n * @param {int} height The height in pixels of the textarea.\n * @param {object} uiParams The UI parameter object.\n */\nclass ScratchpadUi {\n    constructor(textAreaId, width, height, uiParams) {\n        const DEF_UI_PARAMS = {\n            scratchpad_name: '',\n            button_name: '',\n            prefix_name: '',\n            help_text: '',\n            params: {},\n            run_lang: uiParams.lang, // Use answer's ace language if not specified.\n            output_display_mode: 'text',\n            disable_scratchpad: false,\n            wrapper_src: null,\n            open_delimiter: '{|',\n            close_delimiter: '|}',\n            escape: false\n        };\n        this.textArea = document.getElementById(textAreaId);\n        this.textAreaId = textAreaId;\n        this.height = height;\n        this.readOnly = this.textArea.readonly;\n        this.fail = false;\n        this.outerDiv = null;\n        this.outputDisplay = null;\n        this.invertPreload = uiParams.invert_prefix;\n        this.lang = uiParams.lang;\n        this.numRows = this.textArea.rows;\n        this.uiParams = overwriteValues(DEF_UI_PARAMS, uiParams);\n        this.runWrapper = this.getRunWrapper();\n        const preloadString = this.textArea.value;\n        let preload;\n        try {\n            preload = this.readJson(preloadString);\n        } catch (error) {\n            this.fail = true;\n            this.failString = 'scratchpad_ui_invalidserialisation';\n            return;\n        }\n        this.updateContext(preload);\n        this.reload(); // Draw my beautiful blobs.\n    }\n\n    getRunWrapper() {\n        const wrapperSrc = this.uiParams.wrapper_src;\n        let runWrapper = null;\n        if (wrapperSrc) {\n            if (wrapperSrc === 'globalextra' || wrapperSrc === 'prototypeextra') {\n                runWrapper = this.textArea.dataset[wrapperSrc];\n            } else {\n                this.fail = true;\n                this.failString = 'scratchpad_ui_badrunwrappersrc';\n            }\n        }\n        return runWrapper;\n    }\n\n    failed() {\n        return this.fail;\n    }\n\n    failMessage() {\n        return this.failString;\n    }\n\n    sync() {\n        if (!this.context) {\n            return;\n        }\n        const serialisation = this.getSerialisation();\n        this.setSerialisation(serialisation);\n    }\n\n    getSerialisation() {\n        const prefixAns = document.getElementById(this.context.prefix_ans.id);\n        const showHide = document.getElementById(this.context.show_hide.id);\n        // Initialise using the JSON string from the server.\n        let serialisation = {\n            answer_code: [this.context.answer_code.text],\n            test_code: [this.context.test_code.text],\n            show_hide: [this.context.show_hide.show],\n            prefix_ans: [invertSerial(this.context.prefix_ans.checked)]\n        };\n        // If the UI is up and running, update elements from the UI.\n        if (this.answerTextarea) {\n            serialisation.answer_code = [this.answerTextarea.value];\n        }\n        if (this.testTextarea) {\n            serialisation.test_code = [this.testTextarea.value];\n        }\n        if (showHide && !isCollapsed(showHide)) {\n            serialisation.show_hide = ['1'];\n        } else {\n            serialisation.show_hide = [''];\n        }\n        if (prefixAns?.checked || this.context.disable_scratchpad) {\n            serialisation.prefix_ans = ['1'];\n        } else {\n            serialisation.prefix_ans = [''];\n        }\n        if (this.invertPreload) {\n            serialisation.prefix_ans = invertSerial(serialisation.prefix_ans);\n        }\n        return serialisation;\n    }\n\n    setSerialisation(serialisation) {\n        serialisation.prefix_ans = invertSerial(serialisation.prefix_ans);\n        if (Object.values(serialisation).some((val) => val.length === 1 && val[0].length > 0)) {\n            serialisation.prefix_ans = invertSerial(serialisation.prefix_ans);\n            this.textArea.value = JSON.stringify(serialisation);\n        } else {\n            this.textArea.value = ''; // All fields empty...\n        }\n    }\n\n    getElement() {\n        return this.outerDiv;\n    }\n\n    handleRunButtonClick() {\n        if (this.outputDisplay === null) {\n            return;\n        }\n        this.sync(); // Use up-to-date serialization.\n        const preloadString = this.textArea.value;\n        const serial = this.readJson(preloadString);\n        const escape = (code) => this.uiParams.escape ? JSON.stringify(code).slice(1, -1) : code;\n        const answerCode = escape(serial.answer_code[0]);\n        const testCode = escape(serial.test_code[0]);\n        const code = fillWrapper(\n            answerCode,\n            testCode,\n            serial.prefix_ans[0],\n            this.runWrapper,\n            this.uiParams.open_delimiter,\n            this.uiParams.close_delimiter\n        );\n        this.outputDisplay.runCode(code, '', true); // Call with no stdin.\n    }\n\n    updateContext(preload) {\n        this.context = {\n            \"id\": this.textAreaId,\n            \"disable_scratchpad\": this.uiParams.disable_scratchpad,\n            \"scratchpad_name\": this.uiParams.scratchpad_name,\n            \"button_name\": this.uiParams.button_name,\n            \"help_text\": {\"text\": this.uiParams.help_text},\n            \"answer_code\": {\n                \"id\": this.textAreaId + '_answer-code',\n                \"name\": \"answer_code\",\n                \"text\": preload.answer_code[0],\n                \"lang\": this.lang,\n                \"rows\": this.numRows\n            },\n            \"test_code\": {\n                \"id\": this.textAreaId + '_test-code',\n                \"name\": \"test_code\",\n                \"text\": preload.test_code[0],\n                \"lang\": this.lang,\n                \"rows\": 6\n            },\n            \"show_hide\": {\n                \"id\": this.textAreaId + '_scratchpad',\n                \"show\": preload.show_hide[0]\n            },\n            \"prefix_ans\": {\n                \"id\": this.textAreaId + '_prefix-ans',\n                \"label\": this.uiParams.prefix_name,\n                \"checked\": preload.prefix_ans[0]\n            },\n            \"output_display\": {\n                \"id\": this.textAreaId + '_run-output'\n            },\n            // Bootstrap collapse requires jQuery friendly ids to work...\n            \"jquery_escape\": function() {\n                return function(text, render) {\n                    return CSS.escape(render(text));\n                };\n            }\n        };\n    }\n\n    readJson(preloadString) {\n        const defaultSerial = {\n            \"answer_code\": [''],\n            \"test_code\": [''],\n            \"show_hide\": [''],\n            \"prefix_ans\": ['1'] // Ticked by default!\n        };\n        let serial;\n        if (preloadString !== \"\") {\n            try {\n                serial = JSON.parse(preloadString);\n            } catch {\n                // Preload is not JSON, so use preloaded string as answer_code.\n                serial = {\"answer_code\": [preloadString]};\n            }\n            if (!serial.hasOwnProperty(\"answer_code\")) {\n                // No student_answer field... something is wrong!\n                throw TypeError(\"JSON has wrong signature, missing answer_code field.\");\n            }\n        }\n        serial = overwriteValues(defaultSerial, serial);\n\n        if (this.invertPreload) {\n            serial.prefix_ans = invertSerial(serial.prefix_ans);\n        }\n        return serial;\n    }\n\n    async reload() {\n        try {\n            const {html} = await Templates.renderForPromise('qtype_coderunner/scratchpad_ui', this.context);\n            this.drawUi(html);\n            this.addAceUis();\n            this.outputDisplay = new OutputDisplayArea(\n                this.context.output_display.id,\n                this.uiParams.output_display_mode,\n                this.uiParams.run_lang,\n                this.uiParams.params\n            );\n            this.addEventListeners();\n        } catch (e) {\n            this.fail = true;\n            this.failString = \"scratchpad_ui_templateloadfail\";\n        }\n    }\n\n    drawUi(html) {\n        const wrapperDiv = document.getElementById(this.textAreaId).nextSibling;\n        wrapperDiv.innerHTML = html;\n        this.outerDiv = wrapperDiv.firstChild;\n        // No resizing the outer wrapper. Instead, resize the two sub UIs,\n        // they will expand accordingly.\n        wrapperDiv.style.resize = 'none';\n    }\n\n    addAceUis() {\n        this.answerTextarea = document.getElementById(this.context.answer_code.id);\n        this.testTextarea = document.getElementById(this.context.test_code.id);\n        this.answerCodeUi = newUiWrapper('ace', this.context.answer_code.id);\n        if (this.testTextarea) {\n            this.testCodeUi = newUiWrapper('ace', this.context.test_code.id);\n        }\n    }\n\n    addEventListeners() {\n        const runButton = document.getElementById(this.textAreaId + '_run-btn');\n        if (runButton) {\n            runButton.addEventListener('click', () => this.handleRunButtonClick());\n        }\n    }\n\n    resize() {} // Nothing to see here. Move along please.\n\n    hasFocus() {\n        let focused = false;\n        if (this.answerCodeUi?.uiInstance.hasFocus()) {\n            focused = true;\n        }\n        if (this.testCodeUi?.uiInstance.hasFocus()) {\n            focused = true;\n        }\n        return focused;\n    }\n\n    destroy() {\n        this.sync();\n        this.answerCodeUi?.uiInstance.destroy();\n        this.testCodeUiCodeUi?.uiInstance.destroy();\n        this.outerDiv?.remove();\n        this.outerDiv = null;\n    }\n}\n\n\nexport {ScratchpadUi as Constructor};\n"],"names":["obj","_templates","__esModule","default","invertSerial","current","escapeRegExp","string","replace","overwriteValues","defaults","prescribed","overwritten","key","value","Object","entries","_exports","Constructor","constructor","textAreaId","width","height","uiParams","DEF_UI_PARAMS","scratchpad_name","button_name","prefix_name","help_text","params","run_lang","lang","output_display_mode","disable_scratchpad","wrapper_src","open_delimiter","close_delimiter","escape","this","textArea","document","getElementById","readOnly","readonly","fail","outerDiv","outputDisplay","invertPreload","invert_prefix","numRows","rows","runWrapper","getRunWrapper","preloadString","preload","readJson","error","failString","updateContext","reload","wrapperSrc","dataset","failed","failMessage","sync","context","serialisation","getSerialisation","setSerialisation","prefixAns","prefix_ans","id","showHide","show_hide","answer_code","text","test_code","show","checked","answerTextarea","testTextarea","el","classList","contains","Error","isCollapsed","values","some","val","length","JSON","stringify","getElement","handleRunButtonClick","serial","code","slice","answerCode","testCode","template","open","arguments","undefined","close","escOpen","escClose","answerRegex","RegExp","scratchpadRegex","replaceAll","fillWrapper","runCode","name","label","output_display","jquery_escape","render","CSS","parse","hasOwnProperty","TypeError","html","Templates","renderForPromise","drawUi","addAceUis","OutputDisplayArea","addEventListeners","e","wrapperDiv","nextSibling","innerHTML","firstChild","style","resize","answerCodeUi","newUiWrapper","testCodeUi","runButton","addEventListener","hasFocus","focused","uiInstance","destroy","testCodeUiCodeUi","remove"],"mappings":"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"}