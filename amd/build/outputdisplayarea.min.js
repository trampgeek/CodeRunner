define("qtype_coderunner/outputdisplayarea",["exports","jquery","core/ajax","core/str"],(function(_exports,_jquery,_ajax,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * @module coderunner/outputdisplayarea
   * @copyright  James Napier, 2023, The University of Canterbury
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.OutputDisplayArea=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax);_exports.OutputDisplayArea=class{constructor(displayAreaId,outputMode){this.displayAreaId=displayAreaId,this.displayArea=document.getElementById(displayAreaId),this.textDisplay=document.getElementById(displayAreaId+"-text"),this.htmlDisplay=document.getElementById(displayAreaId+"-html"),this.imageDisplay=document.getElementById(displayAreaId+"-images"),this.mode=outputMode,this.stdIn=[]}clearDisplay(){this.textDisplay.innerHTML="",this.htmlDisplay.innerHTML="",this.imageDisplay.innerHTML=""}displayText(response){const output=response.output,error=response.stderr;this.textDisplay.innerText=output+error}displayHtml(response){const output=response.output,error=response.stderr;this.textDisplay.innerHTML=output+error}displayNoOutput(response){const isNoOutput=""===response.output&&""===response.stderr;return isNoOutput&&(this.textDisplay.innerHTML='<span style="color:red">&lt; No output! &gt;</span>'),isNoOutput}display(response){if(!this.displayNoOutput(response))if("json"===this.mode){const json=JSON.parse(response);this.displayJson(json)}else if("html"===this.mode)this.displayHtml(response);else{if("text"!==this.mode)throw Error('Invalid outputMode given: "'.concat(this.mode,'"'));{const text=response;this.displayText(text)}}}async handleRunButtonClick(code,lang,sandboxParams){this.clearDisplay(),_ajax.default.call([{methodname:"qtype_coderunner_run_in_sandbox",args:{contextid:M.cfg.contextid,sourcecode:code,language:lang,params:JSON.stringify(sandboxParams)},done:responseJson=>{const response=JSON.parse(responseJson);this.display(response)},fail:error=>{alert(error.message)}}])}displayJson(json){var result=json,text=result.stdout;42!==result.returncode&&(text+=result.stderr),13==result.returncode&&(text+="\n*** Timeout error ***\n");var base64,numImages=0;if(result.files)for(var prop in(0,_jquery.default)(this.imageDisplay).empty(),result.files){var image=(base64=result.files[prop],(0,_jquery.default)('<img src="data:image/png;base64,'.concat(base64,'">')));(0,_jquery.default)(this.imageDisplay).append(image),numImages+=1}if(""===text.trim()&&42!==result.returncode?0==numImages&&(0,_jquery.default)(this.textDisplay).html('<span style="color:red">&lt; No output! &gt;</span>'):(0,_jquery.default)(this.textDisplay).text(text),42===result.returncode){var inputId="".concat(this.displayAreaId,"-input-field");(0,_jquery.default)(this.textDisplay).html((0,_jquery.default)(this.textDisplay).html()+'<input type="text" id="'.concat(inputId,'">'));var inputEl=(0,_jquery.default)(document.getElementById(inputId));inputEl.focus(),inputEl.on("keyup",(e=>{if(13===e.keyCode){const line=inputEl.val();inputEl.remove(),(0,_jquery.default)(this.textDisplay).html((0,_jquery.default)(this.textDisplay).html()+line),this.handleRunButtonClick()}}))}}}}));

//# sourceMappingURL=outputdisplayarea.min.js.map